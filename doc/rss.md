# Beta Monitor增加订阅系统

## 需求说明

Beta monitor系统定时扫描一个beta设备的相关信息，在第一个版本中，支持异常状况时向owner发送邮件提醒，但有时候，一个用户需要关注一个设备的状态时，可以选择订阅该设备的信息，当订阅后，设备出现异常，则同时将邮件发送给订阅者

## 前置需求

1. 增加发送邮件功能
2. 支持用户认证系统

## 实现方法

### 设备信息

1. 设备信息页面加载时，需要判断当前用户的ID，如果在订阅列表中，则在后面的操作栏，出现取消订阅按钮
2. 当用户不在订阅列表中，则出现订阅按钮
3. 当用户是设备的owner时，不显示该按钮
4. 非登陆用户，该按钮置灰
5. 设备详情页面，增加订阅者信息，显示订阅者的username

### 订阅

1. 登陆用户点击订阅之后，弹出提示，确认是否订阅，订阅成功
2. 订阅成功后，自动发送一封邮件提示，对xxx设备的订阅成功
3. 当设备出现异常时，发送邮件包括设备的owner及订阅者
4. 订阅邮件中包含取消订阅的按钮，该按钮自动生成，当系统接收到该按钮的提交后，无论是否登陆用户，立即将该ID移除订阅列表，并发送邮件通知取消订阅成功

### 取消订阅

1. 登陆用户可以在设备页面上取消自己的订阅
2. 登陆用户注销时，可以不考虑订阅列表，但当发送邮件，查询不到订阅ID对应的user表内容，则认为该用户以注销，不为该用户发送邮件，并且可以考虑刷新该订阅列表


